
<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elenco Ticket</title>
    <style>
    #login-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .login-box {
      background: #36393f;
      padding: 20px;
      border-radius: 8px;
      width: 300px;
    }
        body {
            background-color: #36393f;
            color: #ffffff;
            font-family: 'Whitney', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }
        h1 {
            color: #ffffff;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        li {
            margin: 10px 0;
        }
        a {
            text-decoration: none;
            color: #00b0f4;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>

    <div id="login-modal">
        <div class="login-box">
          <h3>Accesso al Ticket</h3>
          <input type="text" id="user-token" placeholder="Il tuo token temporaneo">
          <input type="text" id="staff-token" placeholder="Token staff (opzionale)">
          <button onclick="verifyAccess()">Accedi</button>
        </div>
      </div>
      
    <h1>Elenco Ticket</h1>
    <div id="content" style="display: none;">
    <ul>

        <li><a href="ticket-scalamobile_1354170472601747757.html">ticket-scalamobile_1354170472601747757</a></li>

        <li><a href="ticket-scalamobile_1354169455336493342.html">ticket-scalamobile_1354169455336493342</a></li>

        <li><a href="ticket-722524694150119427_1353827958627893349.html">ticket-722524694150119427_1353827958627893349</a></li>

        <li><a href="ticket-790547388753248286_1352377048479305819.html">ticket-790547388753248286_1352377048479305819</a></li>

        <li><a href="ticket-941322473205538826_1352376584706850938.html">ticket-941322473205538826_1352376584706850938</a></li>

        <li><a href="ticket-722524694150119427_1352372278649815051.html">ticket-722524694150119427_1352372278649815051</a></li>

        <li><a href="ticket-722524694150119427_1352370234606227467.html">ticket-722524694150119427_1352370234606227467</a></li>

        <li><a href="ticket-scalamobile_1352368819300995132.html">ticket-scalamobile_1352368819300995132</a></li>

        <li><a href="ticket-722524694150119427_1352368091526467626.html">ticket-722524694150119427_1352368091526467626</a></li>

        <li><a href="ticket-722524694150119427_1352367361243746356.html">ticket-722524694150119427_1352367361243746356</a></li>

    </ul>
</div>

<script>
  // Funzione di verifica lato client (versione semplificata)
  async function verifyTokenInFrontend(userToken, staffToken) {    
    // Recupera i parametri dall'URL
    const params = new URLSearchParams(window.location.search);
    const ticketId = params.get('ticket');
    
    // Token staff hardcodato (in produzione usa una chiamata API)
    const STAFF_TOKEN = "il-tuo-token-segreto-per-lo-staff"; // Sostituisci con il tuo token reale
    
    // Se è il token staff, concedi accesso
    if (staffToken === STAFF_TOKEN) return true;
    
    // Altrimenti verifica il token temporaneo
    try {
      // Recupera i token salvati dal localStorage (dovresti salvarli quando generi il ticket)
      const savedTokens = JSON.parse(localStorage.getItem('ticketTokens') || '{}'); 
      const ticketData = savedTokens[ticketId];
      
      if (!ticketData) return false;
      
      // Verifica se il token corrisponde e non è scaduto
      return userToken === ticketData.token && Date.now() < ticketData.expiresAt;
    } catch (e) {
      console.error("Errore verifica token:", e);
      return false;
    }


  // Carica i token dal backend (via API o file statico)
  const response = await fetch('/ticketTokens.json');
  const tokens = await response.json();
  const ticketData = tokens[ticketId];

  // Verifica staff token (da .env)
  if (staffToken === "STAFF_TOKEN_SECRET") return true;

  // Verifica token utente
  return ticketData && 
         userToken === ticketData.token && 
         Date.now() < ticketData.expiresAt;
  }

  function verifyAccess() {
    const userToken = document.getElementById('user-token').value;
    const staffToken = document.getElementById('staff-token').value;
    
    const isValid = verifyTokenInFrontend(userToken, staffToken);
    
    if (isValid) {
      document.getElementById('login-modal').style.display = 'none';
      document.getElementById('content').style.display = 'block';
    } else {
      document.getElementById('error-message').style.display = 'block';
    }
  }
  </script>
</body>
</html>
